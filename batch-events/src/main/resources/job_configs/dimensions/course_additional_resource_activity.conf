# course-additional-resource-activity.conf

parquet-course-additional-resource-activity-planned-source = ${parquet-source} {"path": ${s3.path}"/"${env}"/processing/alef-ccl-published-additional-resource-activity-planned-in-courses"}
parquet-course-additional-resource-activity-updated-source = ${parquet-source} {"path": ${s3.path}"/"${env}"/processing/alef-ccl-published-additional-resource-activity-updated-in-courses"}
parquet-course-additional-resource-activity-unplanned-source = ${parquet-source} {"path": ${s3.path}"/"${env}"/processing/alef-ccl-published-additional-resource-activity-unplanned-in-courses"}
transformed-course-additional-resource-activity-mutated-sink = ${parquet-source-overwrite} {"path": ${s3.path}"/"${env}"/transformed/alef-ccl-published-additional-resource-activity"}
transformed-course-downloadable-resource-activity-mutated-sink = ${parquet-source-overwrite} {"path": ${s3.path}"/"${env}"/transformed/alef-ccl-published-downloadable-resource-activity"}
transformed-course-additional-resource-activity-outcome-association-sink = ${parquet-source-overwrite} {"path": ${s3.path}"/"${env}"/transformed/alef-ccl-published-additional-resource-activity-outcome-association"}
transformed-course-additional-resource-activity-grade-association-sink = ${parquet-source} {"path": ${s3.path}"/"${env}"/transformed/alef-ccl-published-additional-resource-activity-grade-association"}
parquet-course-downloadable-resource-activity-planned-source = ${parquet-source} {"path": ${s3.path}"/"${env}"/processing/alef-ccl-published-downloadable-resource-planned-in-courses"}
parquet-course-downloadable-resource-activity-updated-source = ${parquet-source} {"path": ${s3.path}"/"${env}"/processing/alef-ccl-published-downloadable-resource-updated-in-courses"}
parquet-course-downloadable-resource-activity-unplanned-source = ${parquet-source} {"path": ${s3.path}"/"${env}"/processing/alef-ccl-published-downloadable-resource-unplanned-in-courses"}

parquet-course-additional-resource-activity-planned-sink = ${parquet-source} {"path": ${s3.path}"/"${env}"/data/alef-ccl-published-additional-resource-activity-planned-in-courses"}
parquet-course-additional-resource-activity-updated-sink = ${parquet-source} {"path": ${s3.path}"/"${env}"/data/alef-ccl-published-additional-resource-activity-updated-in-courses"}
parquet-course-additional-resource-activity-unplanned-sink = ${parquet-source} {"path": ${s3.path}"/"${env}"/data/alef-ccl-published-additional-resource-activity-unplanned-in-courses"}
parquet-course-downloadable-resource-activity-planned-sink = ${parquet-source} {"path": ${s3.path}"/"${env}"/data/alef-ccl-published-downloadable-resource-planned-in-courses"}
parquet-course-downloadable-resource-activity-updated-sink = ${parquet-source} {"path": ${s3.path}"/"${env}"/data/alef-ccl-published-downloadable-resource-updated-in-courses"}
parquet-course-downloadable-resource-activity-unplanned-sink = ${parquet-source} {"path": ${s3.path}"/"${env}"/data/alef-ccl-published-downloadable-resource-unplanned-in-courses"}


delta-course-additional-resource-activity-sink = ${delta-sink} {"path" = ${s3.delta.path}"/"${env}"/alef-course-additional-resource-activity-association"}
delta-course-downloadable-resource-activity-sink = ${delta-sink} {"path" = ${s3.delta.path}"/"${env}"/alef-course-additional-resource-activity-association"}
redshift-course-additional-resource-activity-sink = ${redshift} {"dbtable": ${redshift-schema}".dim_course_additional_resource_activity_association"}
redshift-course-downloadable-resource-activity-sink = ${redshift} {"dbtable": ${redshift-schema}".dim_course_additional_resource_activity_association"}

delta-course-resource-activity-outcome-association-dim =  ${delta-sink} {"path" = ${s3.delta.path}"/"${env}"/alef-course-resource-activity-outcome-association"}
redshift-course-resource-activity-outcome-association-rel = ${redshift} {"dbtable": ${redshift-staging-schema}".rel_course_resource_activity_outcome_association"}
redshift-course-resource-activity-grade-association-rel = ${redshift} {"dbtable": ${redshift-staging-schema}".rel_course_resource_activity_grade_association"}
delta-course-resource-activity-grade-association-dim = ${delta-sink} {"path" = ${s3.delta.path}"/"${env}"/alef-course-resource-activity-grade-association"}

parquet-course-additional-resource-activity-planned {
    source: [
      "parquet-course-additional-resource-activity-planned-source"
    ]
    sink: [
      "parquet-course-additional-resource-activity-planned-sink"
    ]
}
parquet-course-additional-resource-activity-updated {
    source: [
      "parquet-course-additional-resource-activity-updated-source"
    ]
    sink: [
      "parquet-course-additional-resource-activity-updated-sink"
    ]
}
parquet-course-additional-resource-activity-unplanned {
    source: [
      "parquet-course-additional-resource-activity-unplanned-source"
    ]
    sink: [
      "parquet-course-additional-resource-activity-unplanned-sink"
    ]
}

parquet-course-downloadable-resource-activity-planned {
    source: [
      "parquet-course-downloadable-resource-activity-planned-source"
    ]
    sink: [
      "parquet-course-downloadable-resource-activity-planned-sink"
    ]
}

parquet-course-downloadable-resource-activity-updated {
    source: [
      "parquet-course-downloadable-resource-activity-updated-source"
    ]
    sink: [
      "parquet-course-downloadable-resource-activity-updated-sink"
    ]
}

parquet-course-downloadable-resource-activity-unplanned {
    source: [
      "parquet-course-downloadable-resource-activity-unplanned-source"
    ]
    sink: [
      "parquet-course-downloadable-resource-activity-unplanned-sink"
    ]
}


delta-course-additional-resource-activity {
    source: [
      "transformed-course-additional-resource-activity-mutated-sink",
      "transformed-course-downloadable-resource-activity-mutated-sink"
    ]
    sink: [
      "delta-course-additional-resource-activity-sink"
    ]
    unique-ids: ["caraa_course_id", "caraa_resource_activity_id"]
    match-conditions: "delta.caraa_resource_activity_id = events.caraa_resource_activity_id AND delta.caraa_course_id = events.caraa_course_id"
    inactive_status_value: 2
}

redshift-course-additional-resource-activity {
    source: [
      "transformed-course-additional-resource-activity-mutated-sink",
      "transformed-course-downloadable-resource-activity-mutated-sink"
    ]
    sink: [
      "redshift-course-additional-resource-activity-sink"
    ]
    unique-ids: ["caraa_course_id", "caraa_resource_activity_id"]
    inactive_status_value: 2
    is_staging_sink: false
}

    transform-course-additional-resource-activity-grade-association {
        planned-source: "parquet-course-additional-resource-activity-planned-source"
        updated-source: "parquet-course-additional-resource-activity-updated-source"
        sink: [
          "transformed-course-additional-resource-activity-grade-association-sink"
        ]
        activity-field: "resourceId"
        activity-id-field: "resourceId"
        attach-events: ["AdditionalResourceActivityPlannedEvent", "AdditionalResourceActivityUpdatedEvent"]
        key: "dim_course_resource_activity_grade_association"
        entity: "craga"
        associationCols: {
                "courseId" : "craga_course_id",
                "craga_activity_id" : "craga_activity_id",
                "craga_status" : "craga_status",
                "occurredOn" : "occurredOn",
                "grade" : "craga_grade_id"
            }
        selectedColList: ["courseId",
                                  "craga_activity_id",
                                  "occurredOn",
                                  "grade",
                                  "eventType"]
    }

  transform-course-downloadable-resource-activity-grade-association {
      planned-source: "parquet-course-downloadable-resource-activity-planned-source"
      updated-source: "parquet-course-downloadable-resource-activity-updated-source"
      sink: [
        "transformed-course-additional-resource-activity-grade-association-sink"
      ]
      activity-field: "resourceId"
      activity-id-field: "resourceId"
      attach-events: ["DownloadableResourcePlannedEvent", "DownloadableResourceUpdatedEvent"]
      key: "dim_course_resource_activity_grade_association"
      entity: "craga"
      associationCols: {
              "courseId" : "craga_course_id",
              "craga_activity_id" : "craga_activity_id",
              "craga_status" : "craga_status",
              "occurredOn" : "occurredOn",
              "grade" : "craga_grade_id"
          }
      selectedColList: ["courseId",
                                "craga_activity_id",
                                "occurredOn",
                                "grade",
                                "eventType"]
  }

  transform-course-additional-resource-activity-outcome-association {
       planned-source: "parquet-course-additional-resource-activity-planned-source"
       updated-source: "parquet-course-additional-resource-activity-updated-source"
       sink: [
            "transformed-course-additional-resource-activity-outcome-association-sink"
       ]
       activity-field: "resourceId"
       activity-id-field: "resourceId"
       attach-events: ["AdditionalResourceActivityPlannedEvent", "AdditionalResourceActivityUpdatedEvent"]
       key: "dim_course_resource_activity_outcome_association"
       entity: "craoa"
       associationCols: {
                   "courseId" : "craoa_course_id",
                   "craoa_activity_id" : "craoa_activity_id",
                   "type" : "craoa_outcome_type",
                    "id" : "craoa_outcome_id",
                    "curriculumId" : "craoa_curr_id",
                    "gradeId" : "craoa_curr_grade_id",
                    "subjectId" : "craoa_curr_subject_id",
                    "craoa_status" : "craoa_status",
                    "occurredOn" : "occurredOn"
           }
       selectedColList: [ "courseId",
                                 "craoa_activity_id",
                                 "type",
                                 "id",
                                 "curriculumId",
                                 "gradeId",
                                 "subjectId",
                                 "occurredOn",
                                 "eventType"]
  }

   redshift-course-additional-resource-activity-outcome-association {
      source: "transformed-course-additional-resource-activity-outcome-association-sink"
      sink: ["redshift-course-resource-activity-outcome-association-rel"]
      unique-ids: ["craoa_activity_id", "craoa_course_id"]
      inactive_status_value: 2
      is_staging_sink: true
   }

 delta-course-additional-resource-activity-outcome-association {
    source: "transformed-course-additional-resource-activity-outcome-association-sink"
    sink: ["delta-course-resource-activity-outcome-association-dim"]
    unique-ids: ["craoa_activity_id", "craoa_course_id"]
    match-conditions: "delta.craoa_activity_id = events.craoa_activity_id AND delta.craoa_course_id = events.craoa_course_id"
    inactive_status_value: 2
 }

 redshift-course-additional-resource-activity-grade-association {
       source: "transformed-course-additional-resource-activity-grade-association-sink"
       sink: ["redshift-course-resource-activity-grade-association-rel"]
       unique-ids: ["craga_activity_id", "craga_course_id"]
       inactive_status_value: 2
       is_staging_sink: true
    }

  delta-course-additional-resource-activity-grade-association {
     source: "transformed-course-additional-resource-activity-grade-association-sink"
     sink: ["delta-course-resource-activity-grade-association-dim"]
     unique-ids: ["craga_activity_id", "craga_course_id"]
     match-conditions: "delta.craga_activity_id = events.craga_activity_id AND delta.craga_course_id = events.craga_course_id"
     inactive_status_value: 2
  }

course-additional-resource-activity-mutated-transform {
      attach-source: ["parquet-course-additional-resource-activity-planned-source"],
      updated-source: ["parquet-course-additional-resource-activity-updated-source"]
      detach-source: ["parquet-course-additional-resource-activity-unplanned-source"]
      sink: [
          "transformed-course-additional-resource-activity-mutated-sink"
      ]
      key: "dim_course_additional_resource_activity_association"
      attach-event-names: ["AdditionalResourceActivityPlannedEvent", "AdditionalResourceActivityUpdatedEvent"]
      detach-event-name: ["AdditionalResourceActivityUnplannedEvent"]
      entity-prefix: "caraa"
      colsMap: {
                             courseId: "caraa_course_id",
                             resourceId: "caraa_resource_activity_id",
                             type: "caraa_resource_activity_type",
                             legacyId: "caraa_resource_activity_legacy_id",
                             caraa_status : "caraa_status",
                             occurredOn : "occurredOn",
                             caraa_attach_status: "caraa_attach_status"
                     }
      attachColsMap: {}
      detachColsMap: {}
      colToTransform: {}
      colToExplode: []
      inactiveStatus: 2
      autoGenerateDwId: true
      groupKeys: ["courseId"]
}

course-downloadable-resource-activity-mutated-transform {
      attach-source: ["parquet-course-downloadable-resource-activity-planned-source"],
      updated-source: ["parquet-course-downloadable-resource-activity-updated-source"]
      detach-source: ["parquet-course-downloadable-resource-activity-unplanned-source"]
      sink: [
          "transformed-course-downloadable-resource-activity-mutated-sink"
      ]
      key: "dim_course_additional_resource_activity_association"
      attach-event-names: ["DownloadableResourcePlannedEvent", "DownloadableResourceUpdatedEvent"]
      detach-event-name: ["DownloadableResourceUnplannedEvent"]
      entity-prefix: "caraa"
      colsMap: {
                             courseId: "caraa_course_id",
                             resourceId: "caraa_resource_activity_id",
                             title: "caraa_resource_activity_title"
                             type: "caraa_resource_activity_type",
                             caraa_status : "caraa_status",
                             occurredOn : "occurredOn",
                             fileInfo.fileName: "caraa_resource_activity_file_name",
                             fileInfo.fileId: "caraa_resource_activity_file_id",
                             caraa_attach_status: "caraa_attach_status"
                     }
      attachColsMap: {}
      detachColsMap: {}
      colToTransform: {}
      colToExplode: []
      autoGenerateDwId: true
      inactiveStatus: 2
      groupKeys: ["courseId"]
}
