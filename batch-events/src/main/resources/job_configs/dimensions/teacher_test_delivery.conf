
parquet-teacher-test-delivery-created-source = ${parquet-source} {"path": ${s3.path}"/"${env}"/processing/alef-test-delivery-created"}
parquet-teacher-test-delivery-created-sink = ${parquet-source} {"path": ${s3.path}"/"${env}"/data/alef-test-delivery-created"}

parquet-teacher-test-delivery-archived-source = ${parquet-source} {"path": ${s3.path}"/"${env}"/processing/alef-test-delivery-archived"}
parquet-teacher-test-delivery-archived-sink = ${parquet-source} {"path": ${s3.path}"/"${env}"/data/alef-test-delivery-archived"}

parquet-teacher-test-delivery-candidate-source = ${parquet-source} {"path": ${s3.path}"/"${env}"/processing/alef-test-delivery-candidate-updated"}
parquet-teacher-test-delivery-candidate-sink = ${parquet-source} {"path": ${s3.path}"/"${env}"/data/alef-test-delivery-candidate-updated"}
transformed-teacher-test-delivery = ${parquet-source-overwrite} {"path": ${s3.path}"/"${env}"/transformed/alef-test-delivery"}
transformed_teacher_test_candidate_association = ${parquet-source-overwrite} {"path": ${s3.path}"/"${env}"/transformed/alef-test-candidate-association"}

delta-teacher-test-delivery-sink = ${delta-sink} {"path" = ${s3.delta.path}"/"${env}"/alef-teacher-test-delivery"}
redshift-teacher-test-delivery-sink = ${redshift} {"dbtable": ${redshift-schema}".dim_teacher_test_delivery_settings"}

delta-teacher-test-delivery-candidate-association-sink = ${delta-sink} {"path" = ${s3.delta.path}"/"${env}"/alef-teacher-test-candidate-association"}
redshift-teacher-test-delivery-candidate-association-sink = ${redshift} {"dbtable": ${redshift-schema}".dim_teacher_test_candidate_association"}

parquet-teacher-test-delivery-created {
    source: [
          "parquet-teacher-test-delivery-created-source"
        ]
        sink: [
          "parquet-teacher-test-delivery-created-sink"
        ]
}

parquet-teacher-test-delivery-candidate-updated {
    source: [
           "parquet-teacher-test-delivery-candidate-source"
        ]
        sink: [
           "parquet-teacher-test-delivery-candidate-sink"
        ]
}

parquet-teacher-test-delivery-candidate-archived {
    source: [
           "parquet-teacher-test-delivery-archived-source"
        ]
        sink: [
           "parquet-teacher-test-delivery-archived-sink"
        ]
}

teacher-test-delivery-mutated-transform {
       create: {
                 source: ["parquet-teacher-test-delivery-created-source"]
                 column-mapping: {
                                 testId: "ttds_test_id",
                                 tenantId: "ttds_tenant_id",
                                 id: "ttds_test_delivery_id",
                                 deliverySettings.startTime: "ttds_test_start_time",
                                 deliverySettings.endTime: "ttds_test_end_time",
                                 deliverySettings.allowLateSubmission: "ttds_allow_late_submission",
                                 deliverySettings.title: "ttds_title",
                                 deliverySettings.stars: "ttds_stars",
                                 deliverySettings.randomized: "ttds_randomized",
                                 status: "ttds_delivery_status",
                                 occurredOn: "occurredOn",
                                 ttds_status: "ttds_status"
                               }
              }
              delete: {
                                                    source: ["parquet-teacher-test-delivery-archived-source"]
                                                    column-mapping: {
                                                                         "id": "ttds_test_delivery_id",
                                                                         "status": "ttds_delivery_status",
                                                                         "occurredOn": "occurredOn"
                                                    }
                                          }
              transformations: [
                   {
                     "operation": "stringToTimestamp"
                     "columns": ["ttds_test_start_time", "ttds_test_end_time"]
                   }
              ]
              sink: "transformed-teacher-test-delivery"
              entity: "ttds",
              unique-ids: ["id"],
              key: "dim_teacher_test_delivery_settings"
              table-name: "delta-teacher-test-delivery-sink"
}

teacher-test-delivery-candidate-transform {
           source: ["parquet-teacher-test-delivery-candidate-source", "parquet-teacher-test-delivery-created-source"]
           sink: "transformed_teacher_test_candidate_association"
           delete-event-name: ""
           column-mapping: {
                         id: "ttca_test_delivery_id",
                         testId: "ttca_test_id",
                         ttca_status: "ttca_status",
                         occurredOn: "occurredOn",
                         ttca_active_until: "ttca_active_until",
                         candidates: "ttca_test_candidate_id"
           }
           transformations: [
                             {
                               "operation": "explode"
                               "columns": ["candidates"]
                             }
                           ]
           entity: "ttca",
           unique-ids: ["id"],
           key: "dim_teacher_test_candidate_association"
}

delta-teacher-test-delivery-candidate-service {
    source: "transformed_teacher_test_candidate_association"
    sink: ["delta-teacher-test-delivery-candidate-association-sink"]
    unique-ids: ["ttca_test_delivery_id"]
    entity-prefix: "ttca"
}

redshift-teacher-test-delivery-candidate-service {
            source: "transformed_teacher_test_candidate_association"
            sink: ["redshift-teacher-test-delivery-candidate-association-sink"]
            dim-table: "dim_teacher_test_candidate_association"
            unique-ids: ["ttca_test_delivery_id"]
            entity-prefix: "ttca"
            inactive_status_value: 2,
            is-staging: false
}

delta-teacher-test-delivery-created-service {
            source: "transformed-teacher-test-delivery",
            sink:  "delta-teacher-test-delivery-sink"
            unique-ids: ["ttds_test_delivery_id"]
            inactive_status_value: 2
}

redshift-teacher-test-delivery-created-service {
    source: "transformed-teacher-test-delivery"
    sink: "redshift-teacher-test-delivery-sink"
    table-name: "dim_teacher_test_delivery_settings"
    exclude-columns: []
    unique-ids: ["ttds_test_delivery_id"],
    inactive_status_value: 2,
    is-staging: false
}
