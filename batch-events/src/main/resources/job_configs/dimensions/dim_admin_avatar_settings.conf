parquet-ccl-marketplace-avatar-created-source = ${parquet-source} {"path": ${s3.path}"/"${env}"/processing/alef-ccl-marketplace-avatar-created"}
parquet-ccl-marketplace-avatar-updated-source   = ${parquet-source} {"path": ${s3.path}"/"${env}"/processing/alef-ccl-marketplace-avatar-updated"}
parquet-ccl-marketplace-avatar-deleted-source = ${parquet-source} {"path": ${s3.path}"/"${env}"/processing/alef-ccl-marketplace-avatar-deleted"}

parquet-ccl-marketplace-avatar-created-sink = ${parquet-source} {"path": ${s3.path}"/"${env}"/data/alef-ccl-marketplace-avatar-created"}
parquet-ccl-marketplace-avatar-updated-sink = ${parquet-source} {"path": ${s3.path}"/"${env}"/data/alef-ccl-marketplace-avatar-updated"}
parquet-ccl-marketplace-avatar-deleted-sink = ${parquet-source} {"path": ${s3.path}"/"${env}"/data/alef-ccl-marketplace-avatar-deleted"}

parquet-marketplace-avatar-created-source = ${parquet-source} {"path": ${s3.path}"/"${env}"/processing/alef-marketplace-avatar-created"}
parquet-marketplace-avatar-updated-source   = ${parquet-source} {"path": ${s3.path}"/"${env}"/processing/alef-marketplace-avatar-updated"}
parquet-marketplace-avatar-deleted-source = ${parquet-source} {"path": ${s3.path}"/"${env}"/processing/alef-marketplace-avatar-deleted"}

parquet-marketplace-avatar-created-sink = ${parquet-source} {"path": ${s3.path}"/"${env}"/data/alef-marketplace-avatar-created"}
parquet-marketplace-avatar-updated-sink = ${parquet-source} {"path": ${s3.path}"/"${env}"/data/alef-marketplace-avatar-updated"}
parquet-marketplace-avatar-deleted-sink = ${parquet-source} {"path": ${s3.path}"/"${env}"/data/alef-marketplace-avatar-deleted"}

transformed-ccl-marketplace-avatar = ${parquet-source-overwrite} {"path": ${s3.path}"/"${env}"/transformed/alef-ccl-marketplace-avatar"}

delta-marketplace-avatar-sink = ${delta-sink} {"path" = ${s3.delta.path}"/"${env}"/alef-marketplace-avatar"}
redshift-marketplace-avatar-sink = ${redshift} {"dbtable": ${redshift-schema}".dim_avatar"}

transformed-ccl-marketplace-avatar-customization = ${parquet-source-overwrite} {"path": ${s3.path}"/"${env}"/transformed/alef-marketplace-avatar-customization"}

delta-marketplace-avatar-customization-sink = ${delta-sink} {"path" = ${s3.delta.path}"/"${env}"/alef-marketplace-avatar-customization"}
redshift-marketplace-avatar-customization-sink = ${redshift} {"dbtable": ${redshift-schema}".dim_avatar_layer_customization"}

ccl-marketplace-avatar-raw-data {
       task: {
         create: {
              source: ["parquet-ccl-marketplace-avatar-created-source"]
              sink: ["parquet-ccl-marketplace-avatar-created-sink"]
         }
         create.custom: {
              source: ["parquet-marketplace-avatar-created-source"]
              sink: ["parquet-marketplace-avatar-created-sink"]
         }
         update: {
              source: ["parquet-ccl-marketplace-avatar-updated-source"]
              sink: ["parquet-ccl-marketplace-avatar-updated-sink"]
         }
         update.custom: {
              source: ["parquet-marketplace-avatar-updated-source"]
              sink: ["parquet-marketplace-avatar-updated-sink"]
         }
         delete: {
              source: ["parquet-ccl-marketplace-avatar-deleted-source"]
              sink: ["parquet-ccl-marketplace-avatar-deleted-sink"]
         }
         delete.custom: {
              source: ["parquet-marketplace-avatar-deleted-source"]
              sink: ["parquet-marketplace-avatar-deleted-sink"]
         }
       }
}

ccl-marketplace-avatar-mutated-transform {
       create: {
          source: ["parquet-ccl-marketplace-avatar-created-source", "parquet-marketplace-avatar-created-source"]
          column-mapping: {
                               "id": "avatar_id",
                               "fileId": "avatar_file_id",
                               "status": "avatar_app_status",
                               "avatar_status": "avatar_status",
                               "type": "avatar_type",
                               "name": "avatar_name",
                               "description": "avatar_description",
                               "validFrom": "avatar_valid_from",
                               "validTill": "avatar_valid_till",
                               "category": "avatar_category",
                               "starCost": "avatar_star_cost",
                               "genders": "avatar_genders",
                               "tenants": "avatar_tenants",
                               "organizations": "avatar_organizations",
                               "isEnabledForAllOrgs": "avatar_is_enabled_for_all_orgs",
                               "createdBy": "avatar_created_by",
                               "createdAt": "avatar_created_at",
                               "updatedBy": "avatar_updated_by",
                               "updatedAt": "avatar_updated_at",
                               "occurredOn": "occurredOn"
                 }
       }
       update: {
          source: ["parquet-ccl-marketplace-avatar-updated-source","parquet-marketplace-avatar-updated-source"]
           column-mapping: {
                               "id": "avatar_id",
                               "fileId": "avatar_file_id",
                               "status": "avatar_app_status",
                               "avatar_status": "avatar_status",
                               "type": "avatar_type",
                               "name": "avatar_name",
                               "description": "avatar_description",
                               "validFrom": "avatar_valid_from",
                               "validTill": "avatar_valid_till",
                               "category": "avatar_category",
                               "starCost": "avatar_star_cost",
                               "genders": "avatar_genders",
                               "tenants": "avatar_tenants",
                               "organizations": "avatar_organizations",
                               "isEnabledForAllOrgs": "avatar_is_enabled_for_all_orgs",
                               "createdBy": "avatar_created_by",
                               "createdAt": "avatar_created_at",
                               "updatedBy": "avatar_updated_by",
                               "updatedAt": "avatar_updated_at",
                               "occurredOn": "occurredOn"
                 }
       }
       delete: {
          source: ["parquet-ccl-marketplace-avatar-deleted-source","parquet-marketplace-avatar-deleted-source"]
          column-mapping: {
                               "id": "avatar_id",
                               "fileId": "avatar_file_id",
                               "isEnabledForAllOrgs": "avatar_is_enabled_for_all_orgs",
                               "occurredOn": "occurredOn"
          }
       }
       table-name: "delta-marketplace-avatar-sink"
       sink: "transformed-ccl-marketplace-avatar"
       transformations: [
         {
           "operation": "stringToTimestamp"
           "columns": ["avatar_valid_from", "avatar_valid_till"]
         }
       ]
       entity: "avatar",
       unique-ids: ["id", "fileId"],
       key: "dim_avatar"
}

delta-ccl-marketplace-avatar-service {
    source: "transformed-ccl-marketplace-avatar"
    sink: "delta-marketplace-avatar-sink"
    unique-ids: ["avatar_id", "avatar_file_id"]
    inactive_status_value: 2
}

redshift-ccl-marketplace-avatar-service {
    source: "transformed-ccl-marketplace-avatar"
    sink: "redshift-marketplace-avatar-sink"
    table-name: "dim_avatar"
    exclude-columns: [
                        "avatar_genders",
                        "avatar_tenants",
                        "avatar_organizations",
                        "avatar_created_by",
                        "avatar_created_at",
                        "avatar_updated_by",
                        "avatar_updated_at"
                ]
    unique-ids: ["avatar_id", "avatar_file_id"],
    inactive_status_value: 2,
    is-staging: false
}

ccl-marketplace-avatar-customization-transform {
       create: {
          source: ["parquet-marketplace-avatar-created-source"]
          column-mapping: {
                               "id": "ala_avatar_id",
                               "customization": "ala_layer_id",
                               "ala_status": "ala_status",
                               "occurredOn": "occurredOn"
                 }
       }
       table-name: "delta-marketplace-avatar-customization-sink"
       sink: "transformed-ccl-marketplace-avatar-customization"
       entity: "ala",
       unique-ids: ["id", "customization"],
       transformations: [
                {
                  "operation": "explode"
                  "columns": ["ala_layer_id"]
                }
              ]
       key: "dim_avatar_layer_customization"
}

delta-ccl-marketplace-avatar-customization-service {
    source: "transformed-ccl-marketplace-avatar-customization"
    sink: "delta-marketplace-avatar-customization-sink"
    unique-ids: ["ala_avatar_id", "ala_layer_id"]
    inactive_status_value: 2
}

redshift-ccl-marketplace-avatar-customization-service {
    source: "transformed-ccl-marketplace-avatar-customization"
    sink: "redshift-marketplace-avatar-customization-sink"
    table-name: "dim_avatar_layer_customization"
    unique-ids: ["ala_avatar_id", "ala_layer_id"],
    inactive_status_value: 2,
    is-staging: false
}
