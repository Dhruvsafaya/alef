
parquet-staff-user-source = ${parquet-source} {"path": ${s3.path}"/"${env}"/processing/alef-staff-iam-userMutated"}
parquet-staff-user-sink = ${parquet-source} {"path": ${s3.path}"/"${env}"/data/alef-staff-iam-userMutated"}

parquet-staff-user-school-moved-source = ${parquet-source} {"path": ${s3.path}"/"${env}"/processing/alef-staff-iam-userMoved"}
parquet-staff-user-school-moved-sink = ${parquet-source} {"path": ${s3.path}"/"${env}"/data/alef-staff-iam-userMoved"}

parquet-staff-user-deleted-source = ${parquet-source} {"path": ${s3.path}"/"${env}"/processing/alef-staff-iam-userDeleted"}
parquet-staff-user-deleted-sink = ${parquet-source} {"path": ${s3.path}"/"${env}"/data/alef-staff-iam-userDeleted"}

transformed-staff-rel-user = ${parquet-source-overwrite} {"path": ${s3.path}"/"${env}"/transformed/alef-staff-rel-user"}
transformed-staff-user = ${parquet-source-overwrite} {"path": ${s3.path}"/"${env}"/transformed/alef-staff-user"}
transformed-staff-user-school-role-association = ${parquet-source-overwrite} {"path": ${s3.path}"/"${env}"/transformed/alef-staff-user-school-role-association"}

redshift-staff-user-rel = ${redshift} {"dbtable": ${redshift-staging-schema}".rel_staff_user"}
redshift-staff-user-dim = ${redshift} {"dbtable": ${redshift-schema}".dim_staff_user"}
redshift-staff-user-school-role-rel = ${redshift} {"dbtable": ${redshift-staging-schema}".rel_staff_user_school_role_association"}
redshift-staff-user-school-role-dim = ${redshift} {"dbtable": ${redshift-schema}".dim_staff_user_school_role_association"}
redshift-user-rel-staff = ${redshift} {"dbtable": ${redshift-staging-schema}".rel_user"}

delta-staff-user-sink = ${delta-sink} {"path" = ${s3.delta.path}"/"${env}"/alef-staff-user"}
delta-staff-user-school-role-sink = ${delta-sink} {"path" = ${s3.delta.path}"/"${env}"/alef-staff-user-school-role-association"}

parquet-staff-user {
    source: [
      "parquet-staff-user-source"
    ]
    sink: [
      "parquet-staff-user-sink"
    ]
}

parquet-staff-user-school-moved {
    source: [
      "parquet-staff-user-school-moved-source"
    ]
    sink: [
      "parquet-staff-user-school-moved-sink"
    ]
}

parquet-staff-user-deleted {
    source: [
      "parquet-staff-user-deleted-source"
    ]
    sink: [
      "parquet-staff-user-deleted-sink"
    ]
}

staff-rel-user-transform {
    source: [
        "parquet-staff-user-source"
    ]
    sink: [
        "transformed-staff-rel-user"
    ]
}

staff-user-transform {
    staff-source: "parquet-staff-user-source"
    staff-delete-source: "parquet-staff-user-deleted-source"
    sink: [
        "transformed-staff-user"
    ]
}

staff-user-school-role-association-transform {
    staff-source: "parquet-staff-user-source"
    school-moved-source: "parquet-staff-user-school-moved-source"
    sink: [
        "transformed-staff-user-school-role-association"
    ]
}

redshift-rel-user-service {
    source: [
        "transformed-staff-rel-user"
    ]
    sink: [
        "redshift-user-rel-staff"
    ]
    unique-ids: ["user_id"]
    table-name: "rel_user"
    is-staging: true
}

redshift-staff-user-service {
    source: "transformed-staff-user"
    sink: [
        "redshift-staff-user-rel"
    ]
    unique-ids: ["staff_user_id"]
    entity-prefix: "staff_user"
    dim-table: "dim_staff_user"
    rel-table: "rel_staff_user"
}

delta-staff-user-service {
    source: "transformed-staff-user"
    sink: [
        "delta-staff-user-sink"
    ]
    unique-ids: ["staff_user_id"]
    entity-prefix: "staff_user"
}

redshift-user-school-role-association-service {
    source: "transformed-staff-user-school-role-association"
    sink: [
        "redshift-staff-user-school-role-rel"
    ]
    unique-ids: ["susra_staff_id"]
    entity-prefix: "susra"
    dim-table: "dim_staff_user_school_role_association"
    rel-table: "rel_staff_user_school_role_association"
}

delta-user-school-role-association-service {
    source: "transformed-staff-user-school-role-association"
    sink: [
        "delta-staff-user-school-role-sink"
    ]
    unique-ids: ["susra_staff_id"]
    entity-prefix: "susra"
}